name: Keep services alive

on:
  schedule:
    - cron: "*/5 * * * *"   # every 5 minutes
  workflow_dispatch:

permissions:
  contents: read

jobs:
  ping:
    runs-on: ubuntu-latest
    env:
      # Use secrets if provided; otherwise use the specified defaults
      SIMULATOR_URL: ${{ secrets.SIMULATOR_URL || 'https://wgc-digitaltwin-bc-3zhl7gknvuadgvnd64z8nr.streamlit.app' }}
      BACKEND_URL:   ${{ secrets.BACKEND_URL   || 'https://wgc-digitaltwin-bc-1.onrender.com' }}
    steps:
      - name: Ping Streamlit UI (best-effort) and Backend (required)
        shell: bash
        run: |
          set -euo pipefail

          SIM="${SIMULATOR_URL%/}"
          BE="${BACKEND_URL%/}"

          echo "Simulator/UI: $SIM"
          echo "Backend/API:  $BE"

          # 1) Best-effort ping of Streamlit UI (OK if it fails)
          echo "Pinging UI (optional): ${SIM}/"
          if curl -fsS "${SIM}/" >/dev/null; then
            echo "UI OK"
          else
            echo "UI ping failed (continuing)"
          fi

          # 2) Required ping of backend /recent-wgc (must succeed)
          echo "Pinging backend (required): ${BE}/recent-wgc"
          curl -fsS "${BE}/recent-wgc" >/dev/null
          echo "Backend OK â€” keepalive success"

